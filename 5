root@opexwise-ml3:/home/balasubramaniyan.d/irise_llama# docker build -t cio/llama2_irise:0.0  .
[+] Building 7.9s (6/11)                                                                                            docker:default
 => [internal] load build definition from Dockerfile                                                                          0.0s
 => => transferring dockerfile: 1.83kB                                                                                        0.0s
 => [internal] load metadata for docker.io/tiangolo/uvicorn-gunicorn-fastapi:python3.7                                        0.3s
 => [internal] load .dockerignore                                                                                             0.0s
 => => transferring context: 2B                                                                                               0.0s
 => CACHED [1/7] FROM docker.io/tiangolo/uvicorn-gunicorn-fastapi:python3.7@sha256:47dc04578b9c523b9d2407c9fc6063468fa6b5512  0.0s
 => [internal] load build context                                                                                             0.0s
 => => transferring context: 8.71kB                                                                                           0.0s
 => ERROR [2/7] RUN apt-get update && apt-get install -y --no-install-recommends gnupg2 curl ca-certificates &&     curl -fs  7.6s
------                                                                                                                             
 > [2/7] RUN apt-get update && apt-get install -y --no-install-recommends gnupg2 curl ca-certificates &&     curl -fsSL https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub | apt-key add - &&     echo "deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /" > /etc/apt/sources.list.d/cuda.list &&     echo "deb https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64 /" > /etc/apt/sources.list.d/nvidia-ml.list &&     apt-get purge --autoremove -y curl && rm -rf /var/lib/apt/lists/*:                                                                               
0.339 Ign:1 http://deb.debian.org/debian bookworm InRelease
0.361 Ign:2 http://deb.debian.org/debian bookworm-updates InRelease
0.385 Ign:3 http://deb.debian.org/debian-security bookworm-security InRelease
1.363 Ign:1 http://deb.debian.org/debian bookworm InRelease
1.388 Ign:2 http://deb.debian.org/debian bookworm-updates InRelease
1.412 Ign:3 http://deb.debian.org/debian-security bookworm-security InRelease
3.388 Ign:1 http://deb.debian.org/debian bookworm InRelease
3.411 Ign:2 http://deb.debian.org/debian bookworm-updates InRelease
3.436 Ign:3 http://deb.debian.org/debian-security bookworm-security InRelease
7.425 Err:1 http://deb.debian.org/debian bookworm InRelease
7.425   Connection failed [IP: 146.75.94.132 80]
7.448 Err:2 http://deb.debian.org/debian bookworm-updates InRelease
7.448   Connection failed [IP: 146.75.94.132 80]
7.472 Err:3 http://deb.debian.org/debian-security bookworm-security InRelease
7.472   Connection failed [IP: 146.75.94.132 80]
7.478 Reading package lists...
7.502 W: Failed to fetch http://deb.debian.org/debian/dists/bookworm/InRelease  Connection failed [IP: 146.75.94.132 80]
7.502 W: Failed to fetch http://deb.debian.org/debian/dists/bookworm-updates/InRelease  Connection failed [IP: 146.75.94.132 80]
7.502 W: Failed to fetch http://deb.debian.org/debian-security/dists/bookworm-security/InRelease  Connection failed [IP: 146.75.94.132 80]
7.502 W: Some index files failed to download. They have been ignored, or old ones used instead.
7.516 Reading package lists...
7.532 Building dependency tree...
7.534 Reading state information...
7.535 Package gnupg2 is not available, but is referred to by another package.
7.535 This may mean that the package is missing, has been obsoleted, or
7.535 is only available from another source
7.535 However the following packages replace it:
7.535   gpgv gpgsm gnupg-l10n gnupg dirmngr
7.535 
7.535 E: Package 'gnupg2' has no installation candidate
------
Dockerfile:3
--------------------
   2 |     
   3 | >>> RUN apt-get update && apt-get install -y --no-install-recommends \
   4 | >>> gnupg2 curl ca-certificates && \
   5 | >>>     curl -fsSL https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub | apt-key add - && \
   6 | >>>     echo "deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /" > /etc/apt/sources.list.d/cuda.list && \
   7 | >>>     echo "deb https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64 /" > /etc/apt/sources.list.d/nvidia-ml.list && \
   8 | >>>     apt-get purge --autoremove -y curl && \
   9 | >>> rm -rf /var/lib/apt/lists/*
  10 |     
--------------------
ERROR: failed to solve: process "/bin/sh -c apt-get update && apt-get install -y --no-install-recommends gnupg2 curl ca-certificates &&     curl -fsSL https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub | apt-key add - &&     echo \"deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /\" > /etc/apt/sources.list.d/cuda.list &&     echo \"deb https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64 /\" > /etc/apt/sources.list.d/nvidia-ml.list &&     apt-get purge --autoremove -y curl && rm -rf /var/lib/apt/lists/*" did not complete successfully: exit code: 100
root@opexwise-ml3:/home/balasubramaniyan.d/irise_llama# ^C
root@opexwise-ml3:/home/balasubramaniyan.d/irise_llama# ^C
root@opexwise-ml3:/home/balasubramaniyan.d/irise_llama# cat Dockerfile 
FROM tiangolo/uvicorn-gunicorn-fastapi:python3.7

RUN apt-get update && apt-get install -y --no-install-recommends \
gnupg2 curl ca-certificates && \
    curl -fsSL https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub | apt-key add - && \
    echo "deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /" > /etc/apt/sources.list.d/cuda.list && \
    echo "deb https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64 /" > /etc/apt/sources.list.d/nvidia-ml.list && \
    apt-get purge --autoremove -y curl && \
rm -rf /var/lib/apt/lists/*

ENV CUDA_VERSION 10.2.89

ENV CUDA_PKG_VERSION 10-2=$CUDA_VERSION-1

# For libraries in the cuda-compat-* package: https://docs.nvidia.com/cuda/eula/index.html#attachment-a
# RUN apt-get update && apt-get install -y --no-install-recommends \
#         cuda-cudart-$CUDA_PKG_VERSION \
# cuda-compat-10-2 && \
# ln -s cuda-10.2 /usr/local/cuda && \
#     rm -rf /var/lib/apt/lists/*

# Required for nvidia-docker v1
RUN echo "/usr/local/nvidia/lib" >> /etc/ld.so.conf.d/nvidia.conf && \
    echo "/usr/local/nvidia/lib64" >> /etc/ld.so.conf.d/nvidia.conf

ENV PATH /usr/local/nvidia/bin:/usr/local/cuda/bin:${PATH}
ENV LD_LIBRARY_PATH /usr/local/nvidia/lib:/usr/local/nvidia/lib64

# nvidia-container-runtime
ENV NVIDIA_VISIBLE_DEVICES all
ENV NVIDIA_DRIVER_CAPABILITIES compute,utility
ENV NVIDIA_REQUIRE_CUDA "cuda>=10.2 brand=tesla,driver>=384,driver<385 brand=tesla,driver>=396,driver<397 brand=tesla,driver>=410,driver<411 brand=tesla,driver>=418,driver<419"

COPY ./requirements.txt /app/requirements.txt

RUN pip install -r /app/requirements.txt

RUN pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu117

COPY . /app


root@opexwise-ml3:/home/balasubramaniyan.d/irise_llama# 

